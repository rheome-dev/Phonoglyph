(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{4614:function(e,t,r){Promise.resolve().then(r.bind(r,4967))},4967:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var s=r(1279),a=r(12),n=r(6564),i=r(6949),o=r(4939);function c(e){let{children:t,requireAuth:r=!0,redirectTo:c="/auth/login",fallback:u}=e,l=(0,n.useRouter)(),d=(0,n.useSearchParams)(),{user:h,loading:g}=function(){let[e,t]=(0,a.useState)(null),[r,s]=(0,a.useState)(!0),[n,c]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{try{s(!0);let e=await i.e.getCurrentUser();if(e){t(e),c(null);return}let r=o.C.getCurrentGuestUser();r||(r=o.C.createGuestSession()),t(r),c(null)}catch(e){c(e instanceof Error?e.message:"Failed to load user");try{let e=o.C.createGuestSession();t(e)}catch(e){t(null)}}finally{s(!1)}})();let{data:{subscription:r}}=i.e.onAuthStateChange(async(r,s)=>{if("SIGNED_OUT"===r)t(o.C.createGuestSession());else if("SIGNED_IN"===r&&(null==s?void 0:s.user)){var a,n;let r=e&&"isGuest"in e?e:null,i={id:s.user.id,email:s.user.email,name:null===(a=s.user.user_metadata)||void 0===a?void 0:a.name,image:null===(n=s.user.user_metadata)||void 0===n?void 0:n.avatar_url,created_at:s.user.created_at||"",updated_at:s.user.updated_at||""};if(t(i),r)try{let e=o.C.transferGuestDataToUser(r.id,i.id);console.log("Transferred guest data:",e)}catch(e){console.error("Failed to transfer guest data:",e)}}});return()=>r.unsubscribe()},[]);let u=async()=>{try{s(!0);let e=await i.e.getCurrentUser();if(e)return t(e),c(null),e;let r=o.C.getCurrentGuestUser()||o.C.createGuestSession();return t(r),c(null),r}catch(r){c(r instanceof Error?r.message:"Failed to refresh user");let e=o.C.createGuestSession();return t(e),e}finally{s(!1)}},l=async()=>{try{await i.e.signOut();let e=o.C.createGuestSession();t(e)}catch(e){throw console.error("Sign out error:",e),e}},d=e&&!("isGuest"in e),h=e&&"isGuest"in e,g=!!h&&!!e&&o.C.shouldShowConversionPrompt(e);return{user:e,loading:r,error:n,isAuthenticated:!!d,isGuest:!!h,shouldShowConversionPrompt:g,refreshUser:u,signOut:l,getCurrentUser:i.e.getCurrentUser}}(),[S,m]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{(async()=>{try{if(!r){m(!1);return}if(r&&!h&&!g){let e=window.location.pathname,t=new URL(c,window.location.origin);e!==c&&t.searchParams.set("redirectTo",e),l.push(t.toString());return}if(h&&(window.location.pathname.startsWith("/auth/login")||window.location.pathname.startsWith("/auth/signup"))){let e=d.get("redirectTo")||"/dashboard";l.push(e);return}m(!1)}catch(e){console.error("Auth guard error:",e),m(!1)}})()},[h,g,r,c,l,d]),g||S)?u?(0,s.jsx)(s.Fragment,{children:u}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900","data-testid":"auth-loading-spinner"})}):r&&!h?null:(0,s.jsx)(s.Fragment,{children:t})}var u=r(8673);function l(){return(0,s.jsx)(c,{children:(0,s.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Profile"}),(0,s.jsx)(u.H,{})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"User Profile"}),(0,s.jsx)("p",{className:"text-gray-600",children:"This is a protected route that requires authentication. You can only see this page if you're logged in."}),(0,s.jsxs)("div",{className:"mt-6 border-t pt-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Account Information"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Your account details are managed through your authentication provider."})]})]})]})})})}function d(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-lg text-gray-600",children:"Loading profile..."})]})}),children:(0,s.jsx)(l,{})})}},4939:function(e,t,r){"use strict";r.d(t,{C:function(){return a}});class s{createGuestSession(){let e=this.getStoredSessionId();return(!e||this.isSessionExpired(e))&&(e=this.generateSessionId(),this.storeSessionId(e)),{id:"guest_".concat(e),isGuest:!0,sessionId:e,createdAt:new Date().toISOString(),tempData:this.loadGuestData(e)}}getCurrentGuestUser(){let e=this.getStoredSessionId();return!e||this.isSessionExpired(e)?null:{id:"guest_".concat(e),isGuest:!0,sessionId:e,createdAt:this.getSessionCreatedAt(e)||new Date().toISOString(),tempData:this.loadGuestData(e)}}saveGuestProject(e){let t={...e,id:"guest_project_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),createdAt:new Date().toISOString(),expiresAt:new Date(Date.now()+this.DATA_EXPIRY).toISOString()},r=this.getGuestProjects(e.guestUserId);return r.push(t),this.saveGuestProjects(e.guestUserId,r),t}getGuestProjects(e){let t="".concat(this.GUEST_DATA_KEY,"_").concat(e,"_projects"),r=localStorage.getItem(t);if(!r)return[];try{let t=JSON.parse(r),s=t.filter(e=>!this.isDataExpired(e.expiresAt));return s.length!==t.length&&this.saveGuestProjects(e,s),s}catch(e){return[]}}transferGuestDataToUser(e,t){let r=this.getGuestProjects(e),s=this.getGuestPreferences(e);return this.clearGuestData(e),{projects:r,preferences:s}}clearGuestSession(){let e=this.getStoredSessionId();e&&(this.clearGuestData("guest_".concat(e)),localStorage.removeItem(this.GUEST_SESSION_KEY),localStorage.removeItem("".concat(this.GUEST_SESSION_KEY,"_created")))}shouldShowConversionPrompt(e){let t=this.getGuestProjects(e.id),r=Date.now()-new Date(e.createdAt).getTime();return t.length>0||r>72e5}generateSessionId(){return"".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}getStoredSessionId(){return localStorage.getItem(this.GUEST_SESSION_KEY)}storeSessionId(e){localStorage.setItem(this.GUEST_SESSION_KEY,e),localStorage.setItem("".concat(this.GUEST_SESSION_KEY,"_created"),new Date().toISOString())}getSessionCreatedAt(e){return localStorage.getItem("".concat(this.GUEST_SESSION_KEY,"_created"))}isSessionExpired(e){let t=this.getSessionCreatedAt(e);return!t||Date.now()-new Date(t).getTime()>this.SESSION_DURATION}isDataExpired(e){return new Date(e).getTime()<Date.now()}loadGuestData(e){let t="".concat(this.GUEST_DATA_KEY,"_guest_").concat(e),r=localStorage.getItem(t);if(!r)return{projects:[],preferences:{}};try{return JSON.parse(r)}catch(e){return{projects:[],preferences:{}}}}saveGuestProjects(e,t){let r="".concat(this.GUEST_DATA_KEY,"_").concat(e,"_projects");localStorage.setItem(r,JSON.stringify(t))}getGuestPreferences(e){let t="".concat(this.GUEST_DATA_KEY,"_").concat(e,"_preferences"),r=localStorage.getItem(t);if(!r)return{};try{return JSON.parse(r)}catch(e){return{}}}clearGuestData(e){["".concat(this.GUEST_DATA_KEY,"_").concat(e),"".concat(this.GUEST_DATA_KEY,"_").concat(e,"_projects"),"".concat(this.GUEST_DATA_KEY,"_").concat(e,"_preferences")].forEach(e=>localStorage.removeItem(e))}constructor(){this.GUEST_SESSION_KEY="guest_session_id",this.GUEST_DATA_KEY="guest_user_data",this.SESSION_DURATION=864e5,this.DATA_EXPIRY=6048e5}}let a=new s},771:function(e,t,r){"use strict";r.d(t,{NY:function(){return v},Ee:function(){return I},fC:function(){return w}});var s=r(12),a=r(2845),n=r(479),i=r(7347),o=r(5241),c=r(7934);function u(){return()=>{}}var l=r(1279),d="Avatar",[h,g]=(0,a.b)(d),[S,m]=h(d),f=s.forwardRef((e,t)=>{let{__scopeAvatar:r,...a}=e,[n,i]=s.useState("idle");return(0,l.jsx)(S,{scope:r,imageLoadingStatus:n,onImageLoadingStatusChange:i,children:(0,l.jsx)(o.WV.span,{...a,ref:t})})});f.displayName=d;var _="AvatarImage",E=s.forwardRef((e,t)=>{let{__scopeAvatar:r,src:a,onLoadingStatusChange:d=()=>{},...h}=e,g=m(_,r),S=function(e,t){let{referrerPolicy:r,crossOrigin:a}=t,n=(0,c.useSyncExternalStore)(u,()=>!0,()=>!1),o=s.useRef(null),l=n?(o.current||(o.current=new window.Image),o.current):null,[d,h]=s.useState(()=>G(l,e));return(0,i.b)(()=>{h(G(l,e))},[l,e]),(0,i.b)(()=>{let e=e=>()=>{h(e)};if(!l)return;let t=e("loaded"),s=e("error");return l.addEventListener("load",t),l.addEventListener("error",s),r&&(l.referrerPolicy=r),"string"==typeof a&&(l.crossOrigin=a),()=>{l.removeEventListener("load",t),l.removeEventListener("error",s)}},[l,a,r]),d}(a,h),f=(0,n.W)(e=>{d(e),g.onImageLoadingStatusChange(e)});return(0,i.b)(()=>{"idle"!==S&&f(S)},[S,f]),"loaded"===S?(0,l.jsx)(o.WV.img,{...h,ref:t,src:a}):null});E.displayName=_;var p="AvatarFallback",x=s.forwardRef((e,t)=>{let{__scopeAvatar:r,delayMs:a,...n}=e,i=m(p,r),[c,u]=s.useState(void 0===a);return s.useEffect(()=>{if(void 0!==a){let e=window.setTimeout(()=>u(!0),a);return()=>window.clearTimeout(e)}},[a]),c&&"loaded"!==i.imageLoadingStatus?(0,l.jsx)(o.WV.span,{...n,ref:t}):null});function G(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}x.displayName=p;var w=f,I=E,v=x}},function(e){e.O(0,[311,336,293,69,673,915,264,744],function(){return e(e.s=4614)}),_N_E=e.O()}]);