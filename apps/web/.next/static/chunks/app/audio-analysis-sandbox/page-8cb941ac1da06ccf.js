(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[677],{1097:function(e,t,s){Promise.resolve().then(s.bind(s,9148))},9148:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Z}});var a=s(1279),r=s(12),n=s(5935),i=s(1822),l=s(9413),c=s(4942),o=s(1260);let d=(0,o.Z)("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),h=(0,o.Z)("volume-2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);var m=s(785),u=s(4454),x=s(7290),f=s(5487);function g(e){let{audioBuffer:t,params:s,onAnalysisComplete:a}=e,n=(0,r.useCallback)((e,t)=>{let a=[],r=[];for(let n=0;n<e.length-1024;n+=512){let i=(function(e){let t=e.length,s=[];for(let a=0;a<t;a++){let r=0,n=0;for(let s=0;s<t;s++){let i=-2*Math.PI*a*s/t;r+=e[s]*Math.cos(i),n+=e[s]*Math.sin(i)}s.push({real:r,imag:n})}return s})(e.slice(n,n+1024).map((e,t)=>e*(.5-.5*Math.cos(2*Math.PI*t/1023)))).map(e=>Math.sqrt(e.real*e.real+e.imag*e.imag));if(r.length>0){let e=0;for(let t=0;t<i.length;t++){let s=i[t]-r[r.length-1][t];s>0&&(e+=s)}if(e>s.transientThreshold){let s=n/t,r=Math.min(e/10,1),l=0,c=0;for(let e=1;e<i.length/2;e++)i[e]>l&&(l=i[e],c=e*t/1024);a.push({time:s,intensity:r,frequency:c})}}r.push(i)}return a},[s.transientThreshold]),i=(0,r.useCallback)((e,t)=>{let a=[],r=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];for(let n=0;n<e.length-2048;n+=512){let i=function(e,t){let s=Math.floor(t/2e3),a=Math.floor(t/80),r=0,n=1;for(let t=s;t<a&&t<e.length/2;t++){let s=0,a=0;for(let r=0;r<e.length-t;r++){let n=e[r]-e[r+t];s+=n*n,a+=e[r]*e[r]}a>0&&(s/=a)<n&&(n=s,r=t)}return r>0?t/r:0}(e.slice(n,n+2048).map((e,t)=>e*(.5-.5*Math.cos(2*Math.PI*t/2047))),t);if(i>0&&i<2e3){let e=Math.round(12*Math.log2(i/440)+69)%12,l=Math.min(i/1e3,1);l>s.pitchConfidence&&a.push({time:n/t,pitch:e,confidence:l,note:r[e]})}}return function(e,t){if(0===e.length)return e;let s=[...e],a=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];for(let e=1;e<s.length-1;e++){let r=s[e-1],n=s[e],i=s[e+1],l=Math.round((r.pitch+n.pitch+i.pitch)/3),c=(r.confidence+n.confidence+i.confidence)/3;c>n.confidence*t&&(s[e]={time:n.time,pitch:l,confidence:c,note:a[l]})}return s}(a,s.chromaSmoothing)},[s.pitchConfidence,s.chromaSmoothing]),l=(0,r.useCallback)((e,t)=>{let a=s.rmsWindowSize,r=a/2,n=[];for(let s=0;s<e.length-a;s+=r){let r=e.slice(s,s+a),i=0;for(let e=0;e<r.length;e++)i+=r[e]*r[e];let l=Math.sqrt(i/r.length);n.push({time:s/t,value:l})}return n},[s.rmsWindowSize]),c=(0,r.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,s=Math.floor(e.length/t),a=[];for(let r=0;r<t;r++){let t=r*s,n=Math.min(t+s,e.length),i=0;for(let s=t;s<n;s++)i+=e[s]*e[s];let l=Math.sqrt(i/(n-t));a.push(l)}return a},[]),o=(0,r.useCallback)(async()=>{let e=t.getChannelData(0),r=t.sampleRate,o=n(e,r);a({transients:o,chroma:i(e,r),rms:l(e,r),waveform:c(e),metadata:{sampleRate:r,duration:t.duration,bufferSize:t.length,analysisParams:s}})},[t,s,n,i,l,c,a]);return r.useEffect(()=>{o()},[o,s]),null}var p=s(4038);let v=["#ef4444","#f97316","#eab308","#84cc16","#22c55e","#10b981","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#d946ef"],b=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function j(e){var t,s,o;let{analysisData:m,currentTime:u,duration:x,onSeek:f,isPlaying:g}=e,j=(0,r.useRef)(null),N=(0,r.useRef)(null),y=(0,r.useRef)(null),[w,S]=(0,r.useState)("all"),C=(0,r.useCallback)(()=>{let e=j.current;if(!e||!m.waveform)return;let t=e.getContext("2d");if(!t)return;let s=e.getBoundingClientRect();e.width=s.width*devicePixelRatio,e.height=s.height*devicePixelRatio,t.scale(devicePixelRatio,devicePixelRatio);let a=s.width,r=s.height,n=r/2;t.clearRect(0,0,a,r),t.beginPath(),t.strokeStyle="#ffffff",t.lineWidth=1;let i=m.waveform;for(let e=0;e<i.length;e++){let s=e/(i.length-1)*a,r=n-i[e]*n*.8;0===e?t.moveTo(s,r):t.lineTo(s,r)}t.stroke(),m.transients&&m.transients.forEach(e=>{let s=e.time/x*a,i=e.intensity,l=i*r*.6;t.beginPath(),t.strokeStyle="#ef4444",t.lineWidth=2,t.moveTo(s,n-l/2),t.lineTo(s,n+l/2),t.stroke(),t.beginPath(),t.fillStyle="rgba(239, 68, 68, ".concat(i,")"),t.arc(s,n,4,0,2*Math.PI),t.fill()});let l=u/x*a;t.beginPath(),t.strokeStyle="#fbbf24",t.lineWidth=2,t.moveTo(l,0),t.lineTo(l,r),t.stroke()},[m,u,x]),T=(0,r.useCallback)(()=>{let e=N.current;if(!e||!m.chroma)return;let t=e.getContext("2d");if(!t)return;let s=e.getBoundingClientRect();e.width=s.width*devicePixelRatio,e.height=s.height*devicePixelRatio,t.scale(devicePixelRatio,devicePixelRatio);let a=s.width,r=s.height,n=r/12;t.clearRect(0,0,a,r),m.chroma.forEach(e=>{let s=e.time/x*a,r=(11-e.pitch)*n,i=e.confidence;t.fillStyle="".concat(v[e.pitch]).concat(Math.floor(255*i).toString(16).padStart(2,"0")),t.fillRect(s-2,r,4,n)}),t.fillStyle="#ffffff",t.font="12px monospace",t.textAlign="right";for(let e=0;e<12;e++){let s=(11-e)*n+n/2+4;t.fillText(b[e],30,s)}let i=u/x*a;t.beginPath(),t.strokeStyle="#fbbf24",t.lineWidth=2,t.moveTo(i,0),t.lineTo(i,r),t.stroke()},[m,u,x]),A=(0,r.useCallback)(()=>{let e=y.current;if(!e||!m.rms)return;let t=e.getContext("2d");if(!t)return;let s=e.getBoundingClientRect();e.width=s.width*devicePixelRatio,e.height=s.height*devicePixelRatio,t.scale(devicePixelRatio,devicePixelRatio);let a=s.width,r=s.height;t.clearRect(0,0,a,r),t.beginPath(),t.strokeStyle="#10b981",t.lineWidth=2,m.rms.forEach((e,s)=>{let n=e.time/x*a,i=r-e.value*r;0===s?t.moveTo(n,i):t.lineTo(n,i)}),t.stroke(),t.beginPath(),t.strokeStyle="#10b981",t.lineWidth=2,m.rms.forEach((e,s)=>{let n=e.time/x*a,i=r-e.value*r;0===s&&t.moveTo(n,r),t.lineTo(n,i)}),t.lineTo(a,r),t.closePath(),t.fillStyle="rgba(16, 185, 129, 0.2)",t.fill();let n=u/x*a;t.beginPath(),t.strokeStyle="#fbbf24",t.lineWidth=2,t.moveTo(n,0),t.lineTo(n,r),t.stroke()},[m,u,x]),k=(0,r.useCallback)(e=>{let t=e.currentTarget.getBoundingClientRect();f((e.clientX-t.left)/t.width*x)},[x,f]);return(0,r.useEffect)(()=>{("waveform"===w||"all"===w)&&C(),("chroma"===w||"all"===w)&&T(),("rms"===w||"all"===w)&&A()},[w,C,T,A]),(0,r.useEffect)(()=>{let e=()=>{("waveform"===w||"all"===w)&&C(),("chroma"===w||"all"===w)&&T(),("rms"===w||"all"===w)&&A()};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[w,C,T,A]),(0,a.jsxs)(n.Zb,{className:"bg-slate-800/50 border-slate-700",children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)(n.ll,{className:"text-white flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(d,{className:"w-5 h-5"}),"Analysis Visualization"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.z,{variant:"all"===w?"default":"outline",size:"sm",onClick:()=>S("all"),className:"text-xs",children:"All"}),(0,a.jsx)(i.z,{variant:"waveform"===w?"default":"outline",size:"sm",onClick:()=>S("waveform"),className:"text-xs",children:"Waveform"}),(0,a.jsx)(i.z,{variant:"chroma"===w?"default":"outline",size:"sm",onClick:()=>S("chroma"),className:"text-xs",children:"Chroma"}),(0,a.jsx)(i.z,{variant:"rms"===w?"default":"outline",size:"sm",onClick:()=>S("rms"),className:"text-xs",children:"RMS"})]})]})}),(0,a.jsxs)(n.aY,{className:"space-y-6",children:[("waveform"===w||"all"===w)&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 text-red-400"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Waveform with Transients"}),(0,a.jsxs)(l.C,{variant:"outline",className:"text-slate-300 border-slate-600",children:[(null===(t=m.transients)||void 0===t?void 0:t.length)||0," transients"]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("canvas",{ref:j,onClick:k,className:"w-full h-32 bg-slate-900/50 rounded-lg cursor-pointer"}),(0,a.jsx)("div",{className:"absolute top-2 left-2 text-xs text-slate-400",children:"Click to seek • Red markers = transients"})]})]}),("chroma"===w||"all"===w)&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 text-blue-400"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Chroma Analysis"}),(0,a.jsxs)(l.C,{variant:"outline",className:"text-slate-300 border-slate-600",children:[new Set((null===(s=m.chroma)||void 0===s?void 0:s.map(e=>e.note))||[]).size," unique notes"]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("canvas",{ref:N,onClick:k,className:"w-full h-48 bg-slate-900/50 rounded-lg cursor-pointer"}),(0,a.jsx)("div",{className:"absolute top-2 left-2 text-xs text-slate-400",children:"Click to seek • Colors = chroma classes"})]})]}),("rms"===w||"all"===w)&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h,{className:"w-4 h-4 text-green-400"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"RMS Analysis"}),(0,a.jsxs)(l.C,{variant:"outline",className:"text-slate-300 border-slate-600",children:["Avg: ",(null===(o=m.rms)||void 0===o?void 0:o.length)?(m.rms.reduce((e,t)=>e+t.value,0)/m.rms.length).toFixed(3):"0.000"]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("canvas",{ref:y,onClick:k,className:"w-full h-32 bg-slate-900/50 rounded-lg cursor-pointer"}),(0,a.jsx)("div",{className:"absolute top-2 left-2 text-xs text-slate-400",children:"Click to seek • Green area = RMS amplitude"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t border-slate-600",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("h4",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 text-red-400"}),"Transients"]}),(0,a.jsxs)("div",{className:"space-y-1 text-xs text-slate-400",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),(0,a.jsx)("span",{children:"Onset detection"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-red-500/50 rounded-full"}),(0,a.jsx)("span",{children:"Intensity = opacity"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("h4",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 text-blue-400"}),"Chroma"]}),(0,a.jsxs)("div",{className:"space-y-1 text-xs text-slate-400",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded"}),(0,a.jsx)("span",{children:"C"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded"}),(0,a.jsx)("span",{children:"G"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded"}),(0,a.jsx)("span",{children:"E"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("h4",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[(0,a.jsx)(h,{className:"w-4 h-4 text-green-400"}),"RMS"]}),(0,a.jsxs)("div",{className:"space-y-1 text-xs text-slate-400",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded"}),(0,a.jsx)("span",{children:"Amplitude curve"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-green-500/20 rounded"}),(0,a.jsx)("span",{children:"Filled area"})]})]})]})]})]})]})}var N=s(8497),y=s(8370),w=s(7804),S=s(1577);function C(e){let{params:t,onParamsChange:s}=e,r=(e,a)=>{s({...t,[e]:Array.isArray(a)?a[0]:a})};return(0,a.jsxs)(n.Zb,{className:"bg-slate-800/50 border-slate-700",children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)(n.ll,{className:"text-white flex items-center gap-2",children:[(0,a.jsx)(S.Z,{className:"w-5 h-5"}),"Analysis Parameters"]})}),(0,a.jsxs)(n.aY,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 text-red-400"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Transient Detection"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(y._,{className:"text-slate-300",children:["Transient Threshold: ",t.transientThreshold.toFixed(2)]}),(0,a.jsx)(N.i,{value:[t.transientThreshold],onValueChange:e=>r("transientThreshold",e),min:.1,max:.9,step:.05,className:"mt-2"}),(0,a.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:"Higher values detect fewer, stronger transients"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(y._,{className:"text-slate-300",children:["Onset Threshold: ",t.onsetThreshold.toFixed(2)]}),(0,a.jsx)(N.i,{value:[t.onsetThreshold],onValueChange:e=>r("onsetThreshold",e),min:.05,max:.5,step:.025,className:"mt-2"}),(0,a.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:"Sensitivity for detecting note onsets"})]})]})]}),(0,a.jsx)(w.Z,{className:"bg-slate-600"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 text-blue-400"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Chroma & Pitch Detection"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(y._,{className:"text-slate-300",children:["Chroma Smoothing: ",t.chromaSmoothing.toFixed(2)]}),(0,a.jsx)(N.i,{value:[t.chromaSmoothing],onValueChange:e=>r("chromaSmoothing",e),min:.1,max:.95,step:.05,className:"mt-2"}),(0,a.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:"Higher values create smoother pitch transitions"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(y._,{className:"text-slate-300",children:["Pitch Confidence: ",t.pitchConfidence.toFixed(2)]}),(0,a.jsx)(N.i,{value:[t.pitchConfidence],onValueChange:e=>r("pitchConfidence",e),min:.3,max:.95,step:.05,className:"mt-2"}),(0,a.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:"Minimum confidence for pitch detection"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(y._,{className:"text-slate-300",children:["Min Note Duration: ",t.minNoteDuration.toFixed(2),"s"]}),(0,a.jsx)(N.i,{value:[t.minNoteDuration],onValueChange:e=>r("minNoteDuration",e),min:.05,max:.5,step:.025,className:"mt-2"}),(0,a.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:"Minimum duration for valid notes"})]})]})]}),(0,a.jsx)(w.Z,{className:"bg-slate-600"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsx)(h,{className:"w-4 h-4 text-green-400"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"RMS Analysis"})]}),(0,a.jsx)("div",{className:"space-y-3",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)(y._,{className:"text-slate-300",children:["Window Size: ",t.rmsWindowSize]}),(0,a.jsx)(N.i,{value:[t.rmsWindowSize],onValueChange:e=>r("rmsWindowSize",e),min:256,max:4096,step:128,className:"mt-2"}),(0,a.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:"Larger windows = smoother RMS values"})]})})]}),(0,a.jsxs)("div",{className:"pt-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-slate-300 mb-3",children:"Quick Presets"}),(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsx)("button",{onClick:()=>s({transientThreshold:.2,onsetThreshold:.15,chromaSmoothing:.7,rmsWindowSize:512,pitchConfidence:.6,minNoteDuration:.08}),className:"px-3 py-1 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded-md transition-colors",children:"Sensitive"}),(0,a.jsx)("button",{onClick:()=>s({transientThreshold:.4,onsetThreshold:.25,chromaSmoothing:.8,rmsWindowSize:1024,pitchConfidence:.75,minNoteDuration:.12}),className:"px-3 py-1 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors",children:"Balanced"}),(0,a.jsx)("button",{onClick:()=>s({transientThreshold:.6,onsetThreshold:.35,chromaSmoothing:.9,rmsWindowSize:2048,pitchConfidence:.85,minNoteDuration:.2}),className:"px-3 py-1 text-xs bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors",children:"Conservative"})]})]})]})]})}let T=(0,o.Z)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),A=(0,o.Z)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]);var k=s(7766);function E(e){let{comparison:t,onSaveToCache:s,onLoadFromCache:r,isSaving:c=!1,isLoading:o=!1}=e,h=e=>e>0?(0,a.jsx)(T,{className:"w-4 h-4 text-green-400"}):e<0?(0,a.jsx)(A,{className:"w-4 h-4 text-red-400"}):(0,a.jsx)(k.Z,{className:"w-4 h-4 text-slate-400"}),m=e=>e>0?"bg-green-600/20 text-green-400 border-green-600":e<0?"bg-red-600/20 text-red-400 border-red-600":"bg-slate-600/20 text-slate-400 border-slate-600";return(0,a.jsxs)(n.Zb,{className:"bg-slate-800/50 border-slate-700",children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)(n.ll,{className:"text-white flex items-center gap-2",children:[(0,a.jsx)(d,{className:"w-5 h-5"}),"Analysis Comparison"]})}),(0,a.jsxs)(n.aY,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Transients"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-slate-300",children:"Sandbox"}),(0,a.jsx)(l.C,{variant:"outline",className:"text-blue-400 border-blue-600",children:t.transients.sandbox})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-slate-300",children:"Cached"}),(0,a.jsx)(l.C,{variant:"outline",className:"text-slate-400 border-slate-600",children:t.transients.cached})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-slate-300",children:"Difference"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[h(t.transients.difference),(0,a.jsxs)(l.C,{variant:"outline",className:m(t.transients.difference),children:[t.transients.difference>0?"+":"",t.transients.difference]})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Chroma"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-slate-300",children:"Sandbox"}),(0,a.jsx)(l.C,{variant:"outline",className:"text-blue-400 border-blue-600",children:t.chroma.sandbox})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-slate-300",children:"Cached"}),(0,a.jsx)(l.C,{variant:"outline",className:"text-slate-400 border-slate-600",children:t.chroma.cached})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-slate-300",children:"Difference"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[h(t.chroma.difference),(0,a.jsxs)(l.C,{variant:"outline",className:m(t.chroma.difference),children:[t.chroma.difference>0?"+":"",t.chroma.difference]})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"RMS"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-slate-300",children:"Sandbox"}),(0,a.jsx)(l.C,{variant:"outline",className:"text-blue-400 border-blue-600",children:t.rms.sandbox})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-slate-300",children:"Cached"}),(0,a.jsx)(l.C,{variant:"outline",className:"text-slate-400 border-slate-600",children:t.rms.cached})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-slate-300",children:"Difference"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[h(t.rms.difference),(0,a.jsxs)(l.C,{variant:"outline",className:m(t.rms.difference),children:[t.rms.difference>0?"+":"",t.rms.difference]})]})]})]})]})]}),(0,a.jsxs)("div",{className:"p-4 bg-slate-700/50 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-white mb-2",children:"Summary"}),(0,a.jsxs)("div",{className:"text-sm text-slate-300 space-y-1",children:[t.transients.difference>0&&(0,a.jsxs)("p",{children:["• Sandbox detected ",t.transients.difference," more transients"]}),t.transients.difference<0&&(0,a.jsxs)("p",{children:["• Cached analysis has ",Math.abs(t.transients.difference)," more transients"]}),t.chroma.difference>0&&(0,a.jsxs)("p",{children:["• Sandbox detected ",t.chroma.difference," more chroma events"]}),t.chroma.difference<0&&(0,a.jsxs)("p",{children:["• Cached analysis has ",Math.abs(t.chroma.difference)," more chroma events"]}),t.rms.difference>0&&(0,a.jsxs)("p",{children:["• Sandbox has ",t.rms.difference," more RMS samples"]}),t.rms.difference<0&&(0,a.jsxs)("p",{children:["• Cached analysis has ",Math.abs(t.rms.difference)," more RMS samples"]}),0===t.transients.difference&&0===t.chroma.difference&&0===t.rms.difference&&(0,a.jsx)("p",{children:"• No differences detected between analysis methods"})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(i.z,{onClick:s,disabled:c,className:"bg-purple-600 hover:bg-purple-700 text-white",children:c?"Saving...":"Save to Cache"}),(0,a.jsx)(i.z,{onClick:r,disabled:o,variant:"outline",className:"border-slate-600 text-slate-300 hover:bg-slate-700",children:o?"Loading...":"Load from Cache"})]})]})]})}class _{static convertToCachedFormat(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"master",a=e.transients.map(e=>({time:e.time,type:"transient",intensity:e.intensity,frequency:e.frequency})),r=e.chroma.map(e=>({time:e.time,pitch:e.pitch,confidence:e.confidence,note:e.note})),n=e.rms.map(e=>({time:e.time,value:e.value})),i={transients:e.transients,chroma:e.chroma,rms:e.rms,features:e.transients.map(e=>({time:e.time,type:"transient",intensity:e.intensity})),pitch:r,volume:n,markers:a,timeData:e.transients.map(e=>e.time),frequencies:e.transients.map(e=>e.frequency),waveform:e.waveform,metadata:e.metadata};return{id:"sandbox_".concat(t,"_").concat(Date.now()),fileMetadataId:t,stemType:s,analysisData:i,waveformData:{points:e.waveform,duration:e.metadata.duration,sampleRate:e.metadata.sampleRate,markers:a},metadata:{sampleRate:e.metadata.sampleRate,duration:e.metadata.duration,bufferSize:e.metadata.bufferSize,featuresExtracted:["transients","chroma","rms","waveform"],analysisDuration:0}}}static async saveToCache(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"master";try{let a=this.convertToCachedFormat(e,t,s);return console.log("Sandbox analysis cached format:",a),!0}catch(e){return console.error("Failed to save sandbox analysis to cache:",e),!1}}static async loadFromCache(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"master";try{return console.log("Loading sandbox analysis from cache:",{fileId:e,stemType:t}),null}catch(e){return console.error("Failed to load sandbox analysis from cache:",e),null}}static convertFromCachedFormat(e){try{var t,s,a,r;if(!e||!e.analysisData)return null;let n=e.analysisData;return{transients:n.transients||[],chroma:n.chroma||[],rms:n.rms||[],waveform:(null===(t=e.waveformData)||void 0===t?void 0:t.points)||[],metadata:{sampleRate:(null===(s=e.metadata)||void 0===s?void 0:s.sampleRate)||44100,duration:(null===(a=e.metadata)||void 0===a?void 0:a.duration)||0,bufferSize:(null===(r=e.metadata)||void 0===r?void 0:r.bufferSize)||1024,analysisParams:n.analysisParams||{}}}}catch(e){return console.error("Failed to convert cached analysis to sandbox format:",e),null}}static compareAnalysis(e,t){var s,a,r,n,i,l;let c=e.transients.length,o=e.chroma.length,d=e.rms.length,h=(null==t?void 0:null===(a=t.analysisData)||void 0===a?void 0:null===(s=a.transients)||void 0===s?void 0:s.length)||0,m=(null==t?void 0:null===(n=t.analysisData)||void 0===n?void 0:null===(r=n.chroma)||void 0===r?void 0:r.length)||0,u=(null==t?void 0:null===(l=t.analysisData)||void 0===l?void 0:null===(i=l.rms)||void 0===i?void 0:i.length)||0;return{transients:{sandbox:c,cached:h,difference:c-h},chroma:{sandbox:o,cached:m,difference:o-m},rms:{sandbox:d,cached:u,difference:d-u}}}}var D=s(1909),I=s(8936),R=s(9541),P=s(4164);function M(){let[e,t]=(0,r.useState)({health:"pending",sandboxTest:"pending",sandboxAuth:"pending"}),s=D.S.health.check.useQuery(void 0,{retry:!1,onSuccess:()=>{t(e=>({...e,health:"success"}))},onError:()=>{t(e=>({...e,health:"error"}))}}),c=D.S.audioAnalysisSandbox.test.useQuery(void 0,{retry:!1,onSuccess:()=>{t(e=>({...e,sandboxTest:"success"}))},onError:()=>{t(e=>({...e,sandboxTest:"error"}))}}),o=D.S.audioAnalysisSandbox.getSandboxAnalyses.useQuery({limit:1},{retry:!1,onSuccess:()=>{t(e=>({...e,sandboxAuth:"success"}))},onError:()=>{t(e=>({...e,sandboxAuth:"error"}))}}),d=e=>{switch(e){case"pending":return(0,a.jsx)(I.Z,{className:"w-4 h-4 animate-spin text-yellow-400"});case"success":return(0,a.jsx)(R.Z,{className:"w-4 h-4 text-green-400"});case"error":return(0,a.jsx)(P.Z,{className:"w-4 h-4 text-red-400"})}},h=e=>{switch(e){case"pending":return"bg-yellow-600/20 text-yellow-400 border-yellow-600";case"success":return"bg-green-600/20 text-green-400 border-green-600";case"error":return"bg-red-600/20 text-red-400 border-red-600"}},m=e=>{switch(e){case"pending":return"Testing...";case"success":return"Connected";case"error":return"Failed"}};return(0,a.jsxs)(n.Zb,{className:"bg-slate-800/50 border-slate-700",children:[(0,a.jsx)(n.Ol,{children:(0,a.jsx)(n.ll,{className:"text-white flex items-center gap-2",children:"API Connection Test"})}),(0,a.jsxs)(n.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[d(e.health),(0,a.jsx)("span",{className:"text-slate-300",children:"Health Check"})]}),(0,a.jsx)(l.C,{variant:"outline",className:h(e.health),children:m(e.health)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[d(e.sandboxTest),(0,a.jsx)("span",{className:"text-slate-300",children:"Sandbox Router"})]}),(0,a.jsx)(l.C,{variant:"outline",className:h(e.sandboxTest),children:m(e.sandboxTest)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[d(e.sandboxAuth),(0,a.jsx)("span",{className:"text-slate-300",children:"Sandbox Auth"})]}),(0,a.jsx)(l.C,{variant:"outline",className:h(e.sandboxAuth),children:m(e.sandboxAuth)})]})]}),"error"===e.health&&(0,a.jsxs)("div",{className:"p-3 bg-red-900/20 border border-red-600/50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-red-400",children:"API server is not responding. Please check:"}),(0,a.jsxs)("ul",{className:"text-xs text-red-300 mt-2 space-y-1",children:[(0,a.jsx)("li",{children:"• API server is running on the correct port"}),(0,a.jsx)("li",{children:"• NEXT_PUBLIC_API_URL is set correctly"}),(0,a.jsx)("li",{children:"• No firewall blocking the connection"})]})]}),"error"===e.sandboxTest&&"success"===e.health&&(0,a.jsx)("div",{className:"p-3 bg-red-900/20 border border-red-600/50 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-red-400",children:"Health check passed but sandbox router failed. Check if the router is properly registered."})}),"error"===e.sandboxAuth&&"success"===e.sandboxTest&&(0,a.jsx)("div",{className:"p-3 bg-yellow-900/20 border border-yellow-600/50 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-yellow-400",children:"Sandbox router is working but authentication failed. Make sure you're logged in."})}),"success"===e.health&&"success"===e.sandboxTest&&"success"===e.sandboxAuth&&(0,a.jsx)("div",{className:"p-3 bg-green-900/20 border border-green-600/50 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-green-400",children:"All API endpoints are working correctly! The sandbox is ready to use."})}),(0,a.jsx)(i.z,{onClick:()=>{t({health:"pending",sandboxTest:"pending",sandboxAuth:"pending"}),s.refetch(),c.refetch(),o.refetch()},variant:"outline",className:"w-full border-slate-600 text-slate-300 hover:bg-slate-700",children:"Retry Tests"})]})]})}var z=s(1973);let O=(0,o.Z)("user-check",[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);function G(){let e=D.S.auth.session.useQuery(),t=D.S.auth.me.useQuery(void 0,{retry:!1}),s=(e,t,s)=>e?(0,a.jsx)(I.Z,{className:"w-4 h-4 animate-spin text-yellow-400"}):t?(0,a.jsx)(P.Z,{className:"w-4 h-4 text-red-400"}):s?(0,a.jsx)(R.Z,{className:"w-4 h-4 text-green-400"}):(0,a.jsx)(z.Z,{className:"w-4 h-4 text-slate-400"}),r=(e,t,s)=>e?"bg-yellow-600/20 text-yellow-400 border-yellow-600":t?"bg-red-600/20 text-red-400 border-red-600":s?"bg-green-600/20 text-green-400 border-green-600":"bg-slate-600/20 text-slate-400 border-slate-600",i=(e,t,s)=>e?"Checking...":t?"Not authenticated":s?"Authenticated":"Unknown";return(0,a.jsxs)(n.Zb,{className:"bg-slate-800/50 border-slate-700",children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)(n.ll,{className:"text-white flex items-center gap-2",children:[(0,a.jsx)(O,{className:"w-5 h-5"}),"Authentication Status"]})}),(0,a.jsxs)(n.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[s(e.isLoading,e.isError,e.isSuccess),(0,a.jsx)("span",{className:"text-slate-300",children:"Session Check"})]}),(0,a.jsx)(l.C,{variant:"outline",className:r(e.isLoading,e.isError,e.isSuccess),children:i(e.isLoading,e.isError,e.isSuccess)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[s(t.isLoading,t.isError,t.isSuccess),(0,a.jsx)("span",{className:"text-slate-300",children:"Protected Endpoint"})]}),(0,a.jsx)(l.C,{variant:"outline",className:r(t.isLoading,t.isError,t.isSuccess),children:i(t.isLoading,t.isError,t.isSuccess)})]})]}),e.data&&(0,a.jsxs)("div",{className:"p-3 bg-slate-700/50 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-white mb-2",children:"Session Info"}),(0,a.jsxs)("div",{className:"text-xs text-slate-300 space-y-1",children:[(0,a.jsxs)("p",{children:["Authenticated: ",e.data.authenticated?"Yes":"No"]}),e.data.user&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{children:["User ID: ",e.data.user.id]}),(0,a.jsxs)("p",{children:["Email: ",e.data.user.email]}),(0,a.jsxs)("p",{children:["Name: ",e.data.user.name]})]})]})]}),t.data&&(0,a.jsxs)("div",{className:"p-3 bg-green-900/20 border border-green-600/50 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-white mb-2",children:"User Details"}),(0,a.jsxs)("div",{className:"text-xs text-green-300 space-y-1",children:[(0,a.jsxs)("p",{children:["ID: ",t.data.user.id]}),(0,a.jsxs)("p",{children:["Email: ",t.data.user.email]}),(0,a.jsxs)("p",{children:["Name: ",t.data.user.name]})]})]}),e.isError&&(0,a.jsx)("div",{className:"p-3 bg-red-900/20 border border-red-600/50 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-red-400",children:"Session check failed. This might indicate a connection issue."})}),t.isError&&e.isSuccess&&(0,a.jsxs)("div",{className:"p-3 bg-yellow-900/20 border border-yellow-600/50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-yellow-400",children:"Session exists but protected endpoint failed. This suggests an authentication token issue."}),(0,a.jsx)("p",{className:"text-xs text-yellow-300 mt-2",children:"Try logging out and logging back in to refresh your authentication token."})]})]})]})}function Z(){var e,t,s;let[o,p]=(0,r.useState)(null),[v,b]=(0,r.useState)(null),[N,y]=(0,r.useState)(null),[w,S]=(0,r.useState)(null),[T,A]=(0,r.useState)(null),[k,D]=(0,r.useState)(!1),[I,R]=(0,r.useState)(!1),[P,z]=(0,r.useState)(0),[O,Z]=(0,r.useState)(0),[U,F]=(0,r.useState)(!1),[L,Y]=(0,r.useState)(!1),[W,B]=(0,r.useState)({transientThreshold:.3,onsetThreshold:.2,chromaSmoothing:.8,rmsWindowSize:1024,pitchConfidence:.7,minNoteDuration:.1}),V=(0,r.useRef)(null),{toast:q}=(0,f.pm)(),K=(0,r.useCallback)(e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!s)return;if(!s.type.startsWith("audio/")){q({title:"Invalid file type",description:"Please select an audio file (MP3, WAV, etc.)",variant:"destructive"});return}if(s.size>52428800){q({title:"File too large",description:"Please select a file smaller than 50MB",variant:"destructive"});return}p(s),y(null),z(0),R(!1);let a=new FileReader;a.onload=async e=>{try{var t;let s=null===(t=e.target)||void 0===t?void 0:t.result,a=new(window.AudioContext||window.webkitAudioContext),r=await a.decodeAudioData(s);b(r),Z(r.duration)}catch(e){console.error("Error loading audio:",e),q({title:"Error loading audio",description:"Failed to decode audio file",variant:"destructive"})}},a.readAsArrayBuffer(s)},[q]),H=(0,r.useCallback)(async()=>{v&&(D(!0),y(null),q({title:"Starting analysis...",description:"Processing audio with new parameters"}))},[v,q]),J=(0,r.useCallback)(e=>{y(e),D(!1),w&&A(_.compareAnalysis(e,w)),q({title:"Analysis complete!",description:"Audio analysis finished successfully"})},[w,q]),Q=(0,r.useCallback)(async()=>{if(N&&o){F(!0);try{if(await _.saveToCache(N,"sandbox-file","master"))q({title:"Saved to cache!",description:"Analysis data has been saved to the backend cache"});else throw Error("Failed to save to cache")}catch(e){console.error("Save error:",e),q({title:"Save failed",description:"Failed to save analysis to cache",variant:"destructive"})}finally{F(!1)}}},[N,o,q]),X=(0,r.useCallback)(async()=>{if(o){Y(!0);try{let e=await _.loadFromCache("sandbox-file","master");e?(y(e),q({title:"Loaded from cache!",description:"Analysis data has been loaded from the backend cache"})):q({title:"No cached data",description:"No cached analysis found for this file",variant:"destructive"})}catch(e){console.error("Load error:",e),q({title:"Load failed",description:"Failed to load analysis from cache",variant:"destructive"})}finally{Y(!1)}}},[o,q]),$=(0,r.useCallback)(()=>{V.current&&(I?(V.current.pause(),R(!1)):(V.current.play(),R(!0)))},[I]),ee=(0,r.useCallback)(e=>{V.current&&(V.current.currentTime=e,z(e))},[]),et=(0,r.useCallback)(()=>{V.current&&z(V.current.currentTime)},[]),es=(0,r.useCallback)(()=>{R(!1),z(0)},[]);return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-white",children:"Audio Analysis Sandbox"}),(0,a.jsx)("p",{className:"text-xl text-slate-300",children:"Test transient detection, chroma analysis, and RMS processing"}),(0,a.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,a.jsxs)(l.C,{variant:"outline",className:"text-slate-300 border-slate-600",children:[(0,a.jsx)(c.Z,{className:"w-3 h-3 mr-1"}),"Transient Detection"]}),(0,a.jsxs)(l.C,{variant:"outline",className:"text-slate-300 border-slate-600",children:[(0,a.jsx)(d,{className:"w-3 h-3 mr-1"}),"Chroma Analysis"]}),(0,a.jsxs)(l.C,{variant:"outline",className:"text-slate-300 border-slate-600",children:[(0,a.jsx)(h,{className:"w-3 h-3 mr-1"}),"RMS Processing"]})]})]}),(0,a.jsx)(M,{}),(0,a.jsx)(G,{}),(0,a.jsxs)(n.Zb,{className:"bg-slate-800/50 border-slate-700",children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)(n.ll,{className:"text-white flex items-center gap-2",children:[(0,a.jsx)(m.Z,{className:"w-5 h-5"}),"Audio File Upload"]})}),(0,a.jsx)(n.aY,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("input",{type:"file",accept:"audio/*",onChange:K,className:"block w-full text-sm text-slate-300 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-purple-600 file:text-white hover:file:bg-purple-700"}),o&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-slate-700/50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(c.Z,{className:"w-5 h-5 text-purple-400"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-white font-medium",children:o.name}),(0,a.jsxs)("p",{className:"text-sm text-slate-400",children:[(o.size/1024/1024).toFixed(2)," MB"]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.z,{onClick:H,disabled:k||!v,className:"bg-purple-600 hover:bg-purple-700",children:k?"Analyzing...":"Analyze"}),(0,a.jsx)(i.z,{onClick:$,disabled:!v,variant:"outline",className:"border-slate-600 text-slate-300 hover:bg-slate-700",children:I?(0,a.jsx)(u.Z,{className:"w-4 h-4"}):(0,a.jsx)(x.Z,{className:"w-4 h-4"})})]})]}),o&&(0,a.jsx)("audio",{ref:V,src:URL.createObjectURL(o),onTimeUpdate:et,onEnded:es,className:"hidden"})]})})]}),v&&(0,a.jsx)(g,{audioBuffer:v,params:W,onAnalysisComplete:J}),v&&(0,a.jsx)(C,{params:W,onParamsChange:B}),N&&(0,a.jsx)(j,{analysisData:N,currentTime:P,duration:O,onSeek:ee,isPlaying:I}),T&&(0,a.jsx)(E,{comparison:T,onSaveToCache:Q,onLoadFromCache:X,isSaving:U,isLoading:L}),N&&(0,a.jsxs)(n.Zb,{className:"bg-slate-800/50 border-slate-700",children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)(n.ll,{className:"text-white flex items-center gap-2",children:[(0,a.jsx)(d,{className:"w-5 h-5"}),"Analysis Results"]})}),(0,a.jsx)(n.aY,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"text-center p-4 bg-slate-700/50 rounded-lg",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Transients"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-red-400",children:(null===(e=N.transients)||void 0===e?void 0:e.length)||0}),(0,a.jsx)("p",{className:"text-sm text-slate-400",children:"Detected onsets"})]}),(0,a.jsxs)("div",{className:"text-center p-4 bg-slate-700/50 rounded-lg",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Chroma Notes"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-400",children:new Set((null===(t=N.chroma)||void 0===t?void 0:t.map(e=>e.note))||[]).size}),(0,a.jsx)("p",{className:"text-sm text-slate-400",children:"Unique notes"})]}),(0,a.jsxs)("div",{className:"text-center p-4 bg-slate-700/50 rounded-lg",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"RMS Avg"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-400",children:(null===(s=N.rms)||void 0===s?void 0:s.length)?(N.rms.reduce((e,t)=>e+t.value,0)/N.rms.length).toFixed(3):"0.000"}),(0,a.jsx)("p",{className:"text-sm text-slate-400",children:"Average amplitude"})]})]})})]})]})})}},9413:function(e,t,s){"use strict";s.d(t,{C:function(){return l}});var a=s(1279);s(12);var r=s(5544),n=s(8092);let i=(0,r.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:s,...r}=e;return(0,a.jsx)("div",{className:(0,n.cn)(i({variant:s}),t),...r})}},1822:function(e,t,s){"use strict";s.d(t,{z:function(){return o}});var a=s(1279),r=s(12),n=s(7690),i=s(5544),l=s(8092);let c=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),o=r.forwardRef((e,t)=>{let{className:s,variant:r,size:i,asChild:o=!1,...d}=e,h=o?n.g7:"button";return(0,a.jsx)(h,{className:(0,l.cn)(c({variant:r,size:i,className:s})),ref:t,...d})});o.displayName="Button"},5935:function(e,t,s){"use strict";s.d(t,{Ol:function(){return l},SZ:function(){return o},Zb:function(){return i},aY:function(){return d},eW:function(){return h},ll:function(){return c}});var a=s(1279),r=s(12),n=s(8092);let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow",s),...r})});i.displayName="Card";let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...r})});l.displayName="CardHeader";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("font-semibold leading-none tracking-tight",s),...r})});c.displayName="CardTitle";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});o.displayName="CardDescription";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...r})});d.displayName="CardContent";let h=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",s),...r})});h.displayName="CardFooter"},8370:function(e,t,s){"use strict";s.d(t,{_:function(){return o}});var a=s(1279),r=s(12),n=s(3343),i=s(5544),l=s(8092);let c=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.f,{ref:t,className:(0,l.cn)(c(),s),...r})});o.displayName=n.f.displayName},7804:function(e,t,s){"use strict";s.d(t,{Z:function(){return d}});var a=s(1279),r=s(12),n=s(5241),i="horizontal",l=["horizontal","vertical"],c=r.forwardRef((e,t)=>{let{decorative:s,orientation:r=i,...c}=e,o=l.includes(r)?r:i;return(0,a.jsx)(n.WV.div,{"data-orientation":o,...s?{role:"none"}:{"aria-orientation":"vertical"===o?o:void 0,role:"separator"},...c,ref:t})});c.displayName="Separator";var o=s(8092);let d=r.forwardRef((e,t)=>{let{className:s,orientation:r="horizontal",decorative:n=!0,...i}=e;return(0,a.jsx)(c,{ref:t,decorative:n,orientation:r,className:(0,o.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",s),...i})});d.displayName=c.displayName},8497:function(e,t,s){"use strict";s.d(t,{i:function(){return l}});var a=s(1279),r=s(12),n=s(4571),i=s(8092);let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsxs)(n.fC,{ref:t,className:(0,i.cn)("relative flex w-full touch-none select-none items-center",s),...r,children:[(0,a.jsx)(n.fQ,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-white/20",children:(0,a.jsx)(n.e6,{className:"absolute h-full bg-white/80"})}),(0,a.jsx)(n.bU,{className:"block h-4 w-4 rounded-full border-2 border-white/80 bg-white/50 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});l.displayName=n.fC.displayName},5487:function(e,t,s){"use strict";s.d(t,{pm:function(){return m}});var a=s(12);let r=0,n=new Map,i=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?i(s):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},c=[],o={toasts:[]};function d(e){o=l(o,e),c.forEach(e=>{e(o)})}function h(e){let{...t}=e,s=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>d({type:"DISMISS_TOAST",toastId:s});return d({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function m(){let[e,t]=a.useState(o);return a.useEffect(()=>(c.push(t),()=>{let e=c.indexOf(t);e>-1&&c.splice(e,1)}),[e]),{...e,toast:h,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},4939:function(e,t,s){"use strict";s.d(t,{C:function(){return r}});class a{createGuestSession(){let e=this.getStoredSessionId();return(!e||this.isSessionExpired(e))&&(e=this.generateSessionId(),this.storeSessionId(e)),{id:"guest_".concat(e),isGuest:!0,sessionId:e,createdAt:new Date().toISOString(),tempData:this.loadGuestData(e)}}getCurrentGuestUser(){let e=this.getStoredSessionId();return!e||this.isSessionExpired(e)?null:{id:"guest_".concat(e),isGuest:!0,sessionId:e,createdAt:this.getSessionCreatedAt(e)||new Date().toISOString(),tempData:this.loadGuestData(e)}}saveGuestProject(e){let t={...e,id:"guest_project_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),createdAt:new Date().toISOString(),expiresAt:new Date(Date.now()+this.DATA_EXPIRY).toISOString()},s=this.getGuestProjects(e.guestUserId);return s.push(t),this.saveGuestProjects(e.guestUserId,s),t}getGuestProjects(e){let t="".concat(this.GUEST_DATA_KEY,"_").concat(e,"_projects"),s=localStorage.getItem(t);if(!s)return[];try{let t=JSON.parse(s),a=t.filter(e=>!this.isDataExpired(e.expiresAt));return a.length!==t.length&&this.saveGuestProjects(e,a),a}catch(e){return[]}}transferGuestDataToUser(e,t){let s=this.getGuestProjects(e),a=this.getGuestPreferences(e);return this.clearGuestData(e),{projects:s,preferences:a}}clearGuestSession(){let e=this.getStoredSessionId();e&&(this.clearGuestData("guest_".concat(e)),localStorage.removeItem(this.GUEST_SESSION_KEY),localStorage.removeItem("".concat(this.GUEST_SESSION_KEY,"_created")))}shouldShowConversionPrompt(e){let t=this.getGuestProjects(e.id),s=Date.now()-new Date(e.createdAt).getTime();return t.length>0||s>72e5}generateSessionId(){return"".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}getStoredSessionId(){return localStorage.getItem(this.GUEST_SESSION_KEY)}storeSessionId(e){localStorage.setItem(this.GUEST_SESSION_KEY,e),localStorage.setItem("".concat(this.GUEST_SESSION_KEY,"_created"),new Date().toISOString())}getSessionCreatedAt(e){return localStorage.getItem("".concat(this.GUEST_SESSION_KEY,"_created"))}isSessionExpired(e){let t=this.getSessionCreatedAt(e);return!t||Date.now()-new Date(t).getTime()>this.SESSION_DURATION}isDataExpired(e){return new Date(e).getTime()<Date.now()}loadGuestData(e){let t="".concat(this.GUEST_DATA_KEY,"_guest_").concat(e),s=localStorage.getItem(t);if(!s)return{projects:[],preferences:{}};try{return JSON.parse(s)}catch(e){return{projects:[],preferences:{}}}}saveGuestProjects(e,t){let s="".concat(this.GUEST_DATA_KEY,"_").concat(e,"_projects");localStorage.setItem(s,JSON.stringify(t))}getGuestPreferences(e){let t="".concat(this.GUEST_DATA_KEY,"_").concat(e,"_preferences"),s=localStorage.getItem(t);if(!s)return{};try{return JSON.parse(s)}catch(e){return{}}}clearGuestData(e){["".concat(this.GUEST_DATA_KEY,"_").concat(e),"".concat(this.GUEST_DATA_KEY,"_").concat(e,"_projects"),"".concat(this.GUEST_DATA_KEY,"_").concat(e,"_preferences")].forEach(e=>localStorage.removeItem(e))}constructor(){this.GUEST_SESSION_KEY="guest_session_id",this.GUEST_DATA_KEY="guest_user_data",this.SESSION_DURATION=864e5,this.DATA_EXPIRY=6048e5}}let r=new a},8148:function(e,t,s){"use strict";s.d(t,{O:function(){return i}});var a=s(3895);let r="https://ahqgihozxzpyxrgesnxm.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFocWdpaG96eHpweXhyZ2VzbnhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA5MTAyMDIsImV4cCI6MjA2NjQ4NjIwMn0.cT8XhsaPazK72VbeKQF8izhiedgEdmNqwZp2hB5nYfQ";r&&n||console.error("\uD83D\uDD25 SUPABASE NOT CONFIGURED! Auth and database will not work.");let i=(0,a.eI)(r||"https://dummy.supabase.co",n||"dummy-key")},1909:function(e,t,s){"use strict";s.d(t,{S:function(){return m},u:function(){return u}});var a=s(8032),r=s(3557),n=s(8148),i=s(4939);let l=null,c=null,o=async()=>l||c||(c=n.O.auth.getSession(),l=(await c).data.session,c=null,l);n.O.auth.onAuthStateChange(()=>{l=null,c=null});let d="http://localhost:3001";console.log("\uD83D\uDD27 tRPC API URL Debug:",{envVar:"http://localhost:3001",apiUrl:d,isClient:!0,finalUrl:"".concat(d,"/api/trpc"),environment:"production"}),d||console.error("❌ NEXT_PUBLIC_API_URL is not set! This will cause API calls to fail.");let h=[()=>e=>{var t;let{next:s,op:a}=e;return t=e=>{let t=async function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{let n=await o();if(!n&&r<10){setTimeout(()=>t(r+1),(r+1)*200);return}let l={};if(null==n?void 0:n.access_token)l.Authorization="Bearer ".concat(n.access_token);else{let e=i.C.getCurrentGuestUser();(null==e?void 0:e.sessionId)&&(l["x-guest-session"]=e.sessionId)}let c={...a,context:{...a.context,headers:l}};s(c).subscribe(e)}catch(t){console.warn("Auth link error, attempting request without auth:",t),s({...a,context:a.context}).subscribe(e)}};return t(),()=>{}},{subscribe:e=>(t(e),{unsubscribe(){}}),pipe(){return this}}},(0,r.ch)({url:"".concat(d,"/api/trpc"),fetch:async(e,t)=>{try{let s=await o(),a={"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}};if(null==s?void 0:s.access_token)a.Authorization="Bearer ".concat(s.access_token);else{let e=i.C.getCurrentGuestUser();(null==e?void 0:e.sessionId)&&(a["x-guest-session"]=e.sessionId)}let r=await fetch(e,{...t||{},headers:a});return r.ok||console.warn("HTTP ".concat(r.status,": ").concat(r.statusText," for ").concat(e)),r}catch(e){throw console.error("Network error in tRPC request:",e),e}}})],m=(0,a.ec)(),u=m.createClient({links:h})},8092:function(e,t,s){"use strict";s.d(t,{cn:function(){return n},q:function(){return i}});var a=s(1057),r=s(8755);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,a.W)(t))}let i={log:function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s]},warn:function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s]},error:function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];console.error(...t)},info:function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s]}}},785:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(1260).Z)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},5145:function(e,t,s){"use strict";s.d(t,{gm:function(){return n}});var a=s(12);s(1279);var r=a.createContext(void 0);function n(e){let t=a.useContext(r);return e||t||"ltr"}},3343:function(e,t,s){"use strict";s.d(t,{f:function(){return l}});var a=s(12),r=s(5241),n=s(1279),i=a.forwardRef((e,t)=>(0,n.jsx)(r.WV.label,{...e,ref:t,onMouseDown:t=>{var s;t.target.closest("button, input, select, textarea")||(null===(s=e.onMouseDown)||void 0===s||s.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var l=i},6749:function(e,t,s){"use strict";s.d(t,{t:function(){return n}});var a=s(12),r=s(7347);function n(e){let[t,s]=a.useState(void 0);return(0,r.b)(()=>{if(e){s({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let a,r;if(!Array.isArray(t)||!t.length)return;let n=t[0];if("borderBoxSize"in n){let e=n.borderBoxSize,t=Array.isArray(e)?e[0]:e;a=t.inlineSize,r=t.blockSize}else a=e.offsetWidth,r=e.offsetHeight;s({width:a,height:r})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}s(void 0)},[e]),t}}},function(e){e.O(0,[311,336,293,32,132,915,264,744],function(){return e(e.s=1097)}),_N_E=e.O()}]);